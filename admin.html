<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Giordano - Opera√ß√µes e BI</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --rosa: #e91e63;
            --verde: #2ecc71;
            --azul: #3498db;
            --dark: #1e1e26;
            --bg: #f0f2f5;
        }

        body { font-family: 'Roboto', sans-serif; margin: 0; background: var(--bg); display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar */
        nav { width: 240px; background: white; border-right: 1px solid #ddd; padding: 20px; display: flex; flex-direction: column; z-index: 10; }
        .nav-link { 
            padding: 12px; margin-bottom: 5px; border-radius: 8px; cursor: pointer; 
            color: #555; transition: 0.3s; font-weight: bold; display: flex; align-items: center; gap: 10px;
        }
        .nav-link:hover, .nav-link.active { background: var(--rosa); color: white; }

        main { flex: 1; padding: 25px; overflow-y: auto; }
        .secao { display: none; }
        .secao.active { display: block; animation: fadeIn 0.3s ease; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Kanban Operacional */
        .kanban { display: flex; gap: 20px; align-items: flex-start; }
        .coluna { background: #e2e4e9; border-radius: 12px; flex: 1; padding: 15px; min-height: 80vh; }
        .coluna h3 { font-size: 13px; color: #666; text-transform: uppercase; margin-bottom: 15px; border-bottom: 2px solid #ccc; padding-bottom: 5px; }

        /* Card de Pedido com Fun√ß√µes Integradas */
        .pedido-card { 
            background: white; padding: 15px; border-radius: 10px; margin-bottom: 12px; 
            border-left: 5px solid var(--rosa); box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .pedido-card strong { display: block; font-size: 15px; color: #333; }
        .pedido-card small { color: #777; display: block; margin-bottom: 10px; }

        /* Dropdown e Bot√µes dentro do Card */
        .card-actions { border-top: 1px solid #eee; padding-top: 10px; margin-top: 5px; }
        .pgto-select { 
            width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ddd; 
            font-size: 12px; background: #f9f9f9; outline: none; margin-bottom: 8px;
        }
        .btn-flex { display: flex; gap: 5px; }
        .btn-avancar { flex: 1; background: var(--rosa); color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 12px; }
        .btn-checkout { background: var(--verde); color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; }

        /* PAINEL DE CAIXA ESTILO PDV (MODAL ESCURO) */
        #modal-caixa {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); z-index: 1000; display: none; padding: 50px;
        }
        .pdv-container { max-width: 600px; margin: auto; background: var(--dark); padding: 30px; border-radius: 20px; border: 1px solid #444; }
        .pdv-display { background: #000; padding: 20px; border-radius: 10px; text-align: right; margin-bottom: 20px; border: 1px solid var(--verde); }
        .pdv-total { font-family: 'JetBrains Mono', monospace; font-size: 45px; color: var(--verde); }
        .pdv-input { width: 100%; background: transparent; border: none; border-bottom: 2px solid #444; color: white; font-size: 24px; padding: 10px; font-family: 'JetBrains Mono', monospace; outline: none; margin-top: 15px; }

        /* Dashboard BI */
        .dash-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px; }
        .card-info { background: white; padding: 20px; border-radius: 12px; border-top: 4px solid var(--rosa); }
        .box-white { background: white; padding: 20px; border-radius: 12px; margin-top: 20px; }
    </style>
</head>
<body>

<nav>
    <img src="https://i.ibb.co/v4mYmYm/image-820d13.png" width="60" style="border-radius:50%; margin: 0 auto 20px;">
    <div id="saudacao" style="text-align:center; font-weight:bold; margin-bottom:20px; font-size: 14px;">Ol√°, Giordano!</div>
    
    <div class="nav-link active" onclick="mudarAba('producao', this)"><span>üë®‚Äçüç≥</span> Opera√ß√µes</div>
    <div class="nav-link" onclick="mudarAba('dashboard', this)"><span>üìä</span> Relat√≥rios BI</div>
    
    <div style="margin-top: auto;">
        <button onclick="abrirPDVGeral()" style="width:100%; background:var(--dark); color:white; border:none; padding:15px; border-radius:8px; cursor:pointer; font-weight:bold;">üìü Abrir Calculadora</button>
    </div>
</nav>

<main>
    <div id="producao" class="secao active">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Painel de Opera√ß√µes</h2>
            <div style="color:var(--verde); font-weight:bold;">Caixa Hoje: <span id="caixa-resumo">R$ 0,00</span></div>
        </div>
        <div class="kanban">
            <div class="coluna"><h3>üÜï Novos</h3><div id="cont-pendente"></div></div>
            <div class="coluna"><h3>üë®‚Äçüç≥ Preparo</h3><div id="cont-preparo"></div></div>
            <div class="coluna"><h3>üõµ Rota / Pronto</h3><div id="cont-rota"></div></div>
        </div>
    </div>

    <div id="dashboard" class="secao">
        <h2>Intelig√™ncia de Vendas</h2>
        <div class="dash-cards">
            <div class="card-info"><small>Hoje</small><h2 id="fat-dia">R$ 0,00</h2></div>
            <div class="card-info" style="border-top-color:var(--azul)"><small>Este M√™s</small><h2 id="fat-mes">R$ 0,00</h2></div>
            <div class="card-info" style="border-top-color:var(--verde)"><small>Pedidos Finalizados</small><h2 id="total-vendas">0</h2></div>
        </div>
        <div class="box-white">
            <h3>Faturamento por Produto</h3>
            <div id="ranking-produtos"></div>
        </div>
    </div>
</main>

<div id="modal-caixa">
    <div class="pdv-container">
        <h2 style="color:white; margin-top:0;">Frente de Caixa</h2>
        <div class="pdv-display">
            <small style="color:var(--verde)">TOTAL A RECEBER</small>
            <div class="pdv-total" id="pdv-valor">R$ 0,00</div>
        </div>
        
        <label style="color:#888; font-size:12px;">VALOR RECEBIDO EM DINHEIRO</label>
        <input type="number" class="pdv-input" id="recebido" placeholder="0,00" oninput="calcularTroco()">
        
        <div id="troco-box" style="margin-top:20px; font-size:24px; color:var(--rosa); font-weight:bold; font-family:'JetBrains Mono';">
            TROCO: R$ 0,00
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:30px;">
            <button onclick="fecharModal()" style="background:#444; color:white; border:none; padding:15px; border-radius:8px; cursor:pointer;">Voltar</button>
            <button onclick="confirmarVendaPDV()" style="background:var(--verde); color:white; border:none; padding:15px; border-radius:8px; font-weight:bold; cursor:pointer;">Finalizar Venda</button>
        </div>
    </div>
</div>

<script>
    let pedidoAtivoIdx = null;

    function mudarAba(aba, el) {
        document.querySelectorAll('.secao').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        document.getElementById(aba).classList.add('active');
        el.classList.add('active');
        if(aba === 'dashboard') gerarBI();
    }

    function renderizar() {
        const pedidos = JSON.parse(localStorage.getItem('meusPedidosDG')) || [];
        document.getElementById('cont-pendente').innerHTML = '';
        document.getElementById('cont-preparo').innerHTML = '';
        document.getElementById('cont-rota').innerHTML = '';

        let totalHoje = 0;

        pedidos.forEach((p, i) => {
            if(p.status === 'concluido') {
                totalHoje += parseFloat(p.preco.replace(',', '.'));
                return;
            }

            const container = document.getElementById('cont-' + (p.status || 'pendente'));
            if(container) {
                container.innerHTML += `
                    <div class="pedido-card">
                        <strong>${p.cliente}</strong>
                        <small>${p.nome} - R$ ${p.preco}</small>
                        
                        <div class="card-actions">
                            <select class="pgto-select" id="pgto-${i}">
                                <option value="Pix">üí≥ Pix</option>
                                <option value="Dinheiro">üíµ Dinheiro</option>
                                <option value="Cr√©dito">üí≥ Cart√£o Cr√©dito</option>
                                <option value="D√©bito">üí≥ Cart√£o D√©bito</option>
                            </select>
                            <div class="btn-flex">
                                <button class="btn-avancar" onclick="avancar(${i}, '${p.status || 'pendente'}')">Mover ‚ûî</button>
                                <button class="btn-checkout" onclick="abrirCaixa(${i})" title="Calcular Troco">üìü</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        });
        document.getElementById('caixa-resumo').innerText = `R$ ${totalHoje.toFixed(2).replace('.', ',')}`;
    }

    function abrirCaixa(idx) {
        const p = JSON.parse(localStorage.getItem('meusPedidosDG'))[idx];
        pedidoAtivoIdx = idx;
        document.getElementById('pdv-valor').innerText = "R$ " + p.preco;
        document.getElementById('modal-caixa').style.display = 'block';
        document.getElementById('recebido').focus();
    }

    function calcularTroco() {
        const total = parseFloat(document.getElementById('pdv-valor').innerText.replace('R$', '').replace(',', '.'));
        const recebido = parseFloat(document.getElementById('recebido').value) || 0;
        const troco = recebido - total;
        document.getElementById('troco-box').innerText = troco >= 0 ? `TROCO: R$ ${troco.toFixed(2).replace('.', ',')}` : `FALTANDO: R$ ${Math.abs(troco).toFixed(2)}`;
    }

    function fecharModal() {
        document.getElementById('modal-caixa').style.display = 'none';
        document.getElementById('recebido').value = '';
    }

    function confirmarVendaPDV() {
        if(pedidoAtivoIdx !== null) {
            const metodo = document.getElementById(`pgto-${pedidoAtivoIdx}`).value;
            finalizarPedido(pedidoAtivoIdx, metodo);
            fecharModal();
        }
    }

    function finalizarPedido(idx, metodo) {
        let pds = JSON.parse(localStorage.getItem('meusPedidosDG'));
        pds[idx].status = 'concluido';
        pds[idx].metodoPgto = metodo;
        pds[idx].dataFinalizada = new Date().toISOString();
        localStorage.setItem('meusPedidosDG', JSON.stringify(pds));
        renderizar();
    }

    function avancar(i, atual) {
        const metodo = document.getElementById(`pgto-${i}`).value;
        if(atual === 'rota') {
            finalizarPedido(i, metodo);
        } else {
            let pds = JSON.parse(localStorage.getItem('meusPedidosDG'));
            const fluxo = { 'pendente': 'preparo', 'preparo': 'rota' };
            pds[i].status = fluxo[atual];
            localStorage.setItem('meusPedidosDG', JSON.stringify(pds));
            renderizar();
        }
    }

    function gerarBI() {
        const pedidos = JSON.parse(localStorage.getItem('meusPedidosDG')) || [];
        const concluidos = pedidos.filter(p => p.status === 'concluido');
        let totalMes = 0;
        let ranking = {};

        concluidos.forEach(p => {
            const v = parseFloat(p.preco.replace(',', '.'));
            totalMes += v;
            ranking[p.nome] = (ranking[p.nome] || 0) + 1;
        });

        document.getElementById('fat-mes').innerText = `R$ ${totalMes.toFixed(2).replace('.', ',')}`;
        document.getElementById('total-vendas').innerText = concluidos.length;
        
        const top = Object.entries(ranking).sort((a,b) => b[1]-a[1]);
        document.getElementById('ranking-produtos').innerHTML = top.map(t => `
            <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee;">
                <span>${t[0]}</span><strong>${t[1]}x</strong>
            </div>
        `).join('');
    }

    function abrirPDVGeral() {
        document.getElementById('pdv-valor').innerText = "R$ 0,00";
        pedidoAtivoIdx = null;
        document.getElementById('modal-caixa').style.display = 'block';
    }

    window.addEventListener('storage', renderizar);
    renderizar();
</script>
</body>
</html>